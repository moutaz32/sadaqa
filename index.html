<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="صدقة جارية على روح المغفور له بإذن الله المهندس الحاج محمد المملوك ابن خديجة.">
    <meta name="theme-color" content="#1e293b">
    <title>نور | م. محمد المملوك</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { --primary: #059669; --dark: #0f172a; --light: #f8fafc; --accent: #fbbf24; --glass: rgba(255, 255, 255, 0.98); --shadow: 0 4px 20px rgba(0,0,0,0.08); }
        [data-theme="dark"] { --primary: #34d399; --dark: #020617; --light: #111827; --glass: rgba(30, 41, 59, 0.98); --text: #f1f5f9; }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Tajawal', sans-serif; background: var(--light); color: [data-theme="dark"] ? #fff : #333; transition: 0.3s; padding-bottom: 120px; background-image: radial-gradient(var(--primary) 0.5px, transparent 0.5px); background-size: 20px 20px; }
        
        header { background: linear-gradient(160deg, #064e3b, #065f46); color: white; padding: 50px 20px 80px; text-align: center; border-radius: 0 0 50px 50px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .theme-btn { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }
        
        .intro-text { font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px; }
        .title-text { font-size: 1.3rem; color: #fbbf24; font-weight: bold; margin-bottom: 5px; }
        .deceased-name { font-size: 2rem; font-weight: 900; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.3); line-height: 1.3; }
        
        .container { max-width: 600px; margin: -50px auto 0; padding: 0 15px; position: relative; z-index: 10; }
        
        .friday-banner { display: none; background: linear-gradient(45deg, #fbbf24, #f59e0b); color: #000; text-align: center; padding: 15px; border-radius: 15px; margin-bottom: 20px; font-weight: bold; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* App Install Banner */
        .install-banner { background: #1e293b; color: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; box-shadow: var(--shadow); border-right: 4px solid var(--accent); }
        .install-banner i { font-size: 2rem; color: var(--accent); }
        .install-text { font-size: 0.9rem; line-height: 1.4; }

        .card { background: var(--glass); border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: var(--shadow); border-top: 4px solid var(--primary); }
        [data-theme="dark"] .card { background: #1e293b; color: white; border: none; border-top: 4px solid var(--primary); }
        .card h2 { font-size: 1.2rem; margin-bottom: 15px; color: var(--primary); display: flex; align-items: center; gap: 10px; }

        .special-card { border-top: 4px solid var(--accent) !important; box-shadow: 0 10px 25px rgba(251, 191, 36, 0.15); text-align: center; }
        .media-box { width: 100%; border-radius: 15px; margin-bottom: 15px; border: 2px solid rgba(0,0,0,0.05); }
        .date-badge { display: inline-block; background: var(--primary); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; margin-bottom: 15px; }
        .family-dedication { background: rgba(5, 150, 105, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px dashed var(--primary); }
        [data-theme="dark"] .family-dedication { background: rgba(251, 191, 36, 0.1); border-color: var(--accent); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .action-btn { background: rgba(0,0,0,0.03); padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; font-weight: bold; color: inherit; display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 0.95rem; border: none; text-decoration: none; }
        [data-theme="dark"] .action-btn { background: rgba(255,255,255,0.05); color: white; }
        .action-btn i { font-size: 1.5rem; color: var(--primary); }
        
        .juz-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 8px; margin-bottom: 15px; }
        .juz-btn { background: rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; padding: 10px 0; text-align: center; font-weight: bold; cursor: pointer; transition: 0.3s; color: inherit; }
        [data-theme="dark"] .juz-btn { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.1); }
        .juz-btn.read { background: var(--primary); color: white; border-color: var(--primary); }

        .dua-input { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #ccc; margin-bottom: 10px; font-family: inherit; resize: none; }
        [data-theme="dark"] .dua-input { background: #0f172a; color: white; border-color: #334155; }
        .dua-list { max-height: 250px; overflow-y: auto; text-align: right; padding-right: 5px; }
        .dua-item { background: rgba(0,0,0,0.02); padding: 12px; border-radius: 8px; margin-bottom: 8px; border-right: 3px solid var(--accent); font-size: 0.95rem; line-height: 1.5; }
        [data-theme="dark"] .dua-item { background: rgba(255,255,255,0.05); }

        .gift-btn { width: 100%; padding: 15px; background: var(--accent); color: #1e293b; border: none; border-radius: 15px; font-weight: bold; font-size: 1.1rem; cursor: pointer; display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .whatsapp-btn { background: #25D366; color: white; }
        
        .sebha-circle { width: 150px; height: 150px; background: var(--light); border-radius: 50%; margin: 10px auto; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 5px solid var(--accent); cursor: pointer; }
        [data-theme="dark"] .sebha-circle { background: rgba(255,255,255,0.05); }
        .counter { font-size: 3.5rem; font-weight: 800; color: var(--primary); }

        .share-card { background: #1e293b; color: white; padding: 25px; border-radius: 15px; text-align: center; border: 2px solid var(--accent); margin-bottom: 15px; }

        .floating-player { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--glass); backdrop-filter: blur(10px); padding: 12px 20px; border-top: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: space-between; z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        [data-theme="dark"] .floating-player { background: #1e293b; color: white; }
        .play-toggle { width: 45px; height: 45px; background: var(--primary); color: white; border-radius: 50%; border: none; cursor: pointer; display: grid; place-items: center; font-size: 1.2rem; }

        /* Toast Notification (التذكير) */
        .toast-reminder { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: var(--dark); color: white; padding: 15px 25px; border-radius: 30px; border: 2px solid var(--accent); box-shadow: 0 10px 25px rgba(0,0,0,0.3); z-index: 2000; font-weight: bold; display: flex; align-items: center; gap: 10px; transition: bottom 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); width: 90%; max-width: 400px; text-align: center; justify-content: center; }
        .toast-reminder.show { bottom: 85px; }
        .toast-reminder i { color: var(--accent); font-size: 1.3rem; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; padding: 10px; overflow-y: auto; justify-content: center; align-items: flex-start; }
        .modal.active { display: flex; }
        .modal-content { background: #fff; width: 100%; max-width: 600px; border-radius: 20px; padding: 20px; margin-top: 20px; position: relative; min-height: 50vh; }
        [data-theme="dark"] .modal-content { background: #1e293b; color: white; }
        .close-modal { position: sticky; top: 0; left: 0; background: #ef4444; color: white; width: 35px; height: 35px; border-radius: 50%; display: grid; place-items: center; cursor: pointer; float: left; margin-bottom: 10px; z-index: 5; }
        
        .quran-text { font-family: 'Amiri', serif; font-size: 1.5rem; line-height: 2.6; text-align: center; white-space: pre-wrap; padding-bottom: 30px; }
        .basmala { font-family: 'Amiri', serif; color: var(--primary); font-size: 1.5rem; margin-bottom: 20px; display: block; }
        .loader { text-align: center; font-weight: bold; color: var(--primary); padding: 20px; }
        
        .dua-dead-item { font-size: 1.1rem; line-height: 1.8; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed rgba(0,0,0,0.1); text-align: right; }
        [data-theme="dark"] .dua-dead-item { border-color: rgba(255,255,255,0.1); }
        .dua-number { color: var(--primary); font-weight: bold; margin-left: 5px; font-size: 1.2rem; }
        
        /* تصميم العداد الذكي */
        .smart-counter { background: #0f172a; color: white; padding: 15px 30px; border-radius: 15px; display: inline-flex; align-items: center; justify-content: center; gap: 15px; border: 2px solid var(--primary); margin: 15px 0; box-shadow: 0 5px 15px rgba(5,150,105,0.2); width: 100%; }
        .smart-counter .title { font-size: 1.1rem; color: #94a3b8; }
        .smart-counter .number { font-size: 2.2rem; font-family: monospace; font-weight: 900; color: var(--accent); text-shadow: 0 2px 10px rgba(251, 191, 36, 0.3); }
    </style>
</head>
<body>

    <header>
        <button class="theme-btn" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
        <div class="intro-text">صدقة جارية على روح المغفور له بإذن الله</div>
        <div class="title-text">المهندس الحاج</div>
        <div class="deceased-name">محمد المملوك ابن خديجة</div>
        <p style="font-size:0.9rem; margin-top:10px; opacity:0.9;">اللهم اجعل قبره روضة من رياض الجنة</p>
    </header>

    <div class="container">

        <!-- 1. كارت إضافة التطبيق للشاشة الرئيسية -->
        <div class="install-banner">
            <i class="fas fa-mobile-alt"></i>
            <div class="install-text">
                <strong>اجعل الصدقة أمام عينك:</strong><br>
                اضغط على الـ 3 نقط بالمتصفح، ثم اختر <span style="color:var(--accent)">"إضافة للشاشة الرئيسية"</span> ليصبح الموقع كتطبيق على هاتفك.
            </div>
        </div>

        <div class="friday-banner" id="fridayBanner">
            <i class="fas fa-mosque"></i> اليوم جمعة مباركة.. لا تنسوا قراءة سورة الكهف، والإكثار من الصلاة على النبي ﷺ، والدعاء لوالدنا.
        </div>

        <!-- 2. السيرة العطرة -->
        <div class="card" style="text-align: center;">
            <h2><i class="fas fa-dove" style="color:var(--accent)"></i> أثره الطيب</h2>
            <p style="line-height: 1.8; font-size: 0.95rem; opacity: 0.9;">
                "كان رحمه الله رجلاً طيب القلب، محباً للخير، واصلاً للرحم، يسعى في قضاء حوائج الناس. ترك خلفه سيرة عطرة وأسرة محبة تدعو له. نسأل الله أن يجمعنا به في مستقر رحمته."
            </p>
        </div>

        <!-- 3. وثيقة الصدقة -->
        <div class="card special-card">
            <h2 style="justify-content: center; color: var(--accent); font-size: 1.4rem;">
                <i class="fas fa-certificate"></i> وثيقة الصدقة الجارية
            </h2>
            <div class="family-dedication">
                <p style="font-size: 1rem; line-height: 1.8; font-weight: bold;">
                    هذا العمل الصالح مُقدم بفضل الله من:<br>
                    <span style="color: var(--primary); font-size: 1.2rem;">الزوجة المخلصة، وجميع أبنائه وبناته</span><br>
                    براً ووفاءً وحباً لروح والدهم الغالي.
                </p>
            </div>
            <img src="sak.jpg" alt="صك النخيل" class="media-box" onerror="this.style.display='none'">
        </div>

        <!-- 4. ألبوم النخلة -->
        <div class="card special-card">
            <h2 style="justify-content: center; color: var(--primary); font-size: 1.3rem;">
                <i class="fas fa-tree"></i> ألبوم النخلة المباركة
            </h2>
            <div class="date-badge"><i class="fas fa-calendar-alt"></i> غرة رمضان (19 فبراير 2026)</div>
            <img src="tree.jpg" alt="نخلة الحاج محمد المملوك" class="media-box" onerror="this.style.display='none'">
            <video class="media-box" controls preload="metadata" style="background: #000;">
                <source src="video.mp4" type="video/mp4">
            </video>
        </div>

        <!-- 5. أدعية للمتوفي -->
        <div class="card">
            <h2><i class="fas fa-praying-hands" style="color:#3b82f6"></i> أدعية جامعة للمتوفي</h2>
            <p style="font-size:0.85rem; opacity:0.8; margin-bottom:15px;">مجموعة من أفضل 30 دعاء مأثور للمتوفي، اقرأها بنية الرحمة والمغفرة له.</p>
            <button class="action-btn" style="width:100%; background:var(--primary); color:white; flex-direction: row; justify-content: center; gap: 10px;" onclick="openDeadDuasModal()">
                <i class="fas fa-book-reader" style="color:white; font-size: 1.2rem;"></i> قراءة الـ 30 دعاء
            </button>
        </div>

        <!-- 6. ختمة القرآن -->
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2 style="margin:0;"><i class="fas fa-quran"></i> ختمة القرآن</h2>
                <button onclick="resetKhatmah()" style="background:none; border:none; color:#ef4444; font-size:0.8rem; cursor:pointer;">بدء ختمة جديدة</button>
            </div>
            <p style="font-size:0.85rem; opacity:0.8; margin-bottom:15px;">اختر الجزء الذي قرأته واضغط عليه ليتحول للأخضر.</p>
            <div class="juz-grid" id="juzGrid"></div>
        </div>

        <!-- 7. قراءة القرآن والمصحف -->
        <div class="card">
            <h2><i class="fas fa-book-open"></i> قراءة القرآن</h2>
            <button class="gift-btn" id="fatihaBtn" onclick="giftFatiha()">
                <i class="fas fa-heart"></i> أهديت له الفاتحة
            </button>
            <div class="grid-2">
                <button class="action-btn" onclick="fetchSurah(36, 'سورة يس')"><i class="fas fa-heart" style="color:#ef4444"></i> يس</button>
                <button class="action-btn" onclick="fetchSurah(67, 'سورة الملك')"><i class="fas fa-shield-alt" style="color:#3b82f6"></i> الملك</button>
                <button class="action-btn" onclick="fetchSurah(56, 'سورة الواقعة')"><i class="fas fa-leaf" style="color:#22c55e"></i> الواقعة</button>
                <button class="action-btn" onclick="fetchSurah(18, 'سورة الكهف')"><i class="fas fa-lightbulb" style="color:#eab308"></i> الكهف</button>
            </div>
            
            <a href="https://quran.com/ar" target="_blank" class="action-btn" style="width:100%; margin-top:10px; background:var(--primary); color:white; flex-direction:row; justify-content:center; gap:10px; text-decoration:none;">
                <i class="fas fa-book" style="color:white; font-size:1.2rem;"></i> تصفح المصحف كاملاً
            </a>
        </div>

        <!-- 8. سجل الدعاء (مع زرار الجروب) -->
        <div class="card">
            <h2><i class="fas fa-pen-fancy"></i> سجل الدعاء والذكريات</h2>
            <p style="font-size:0.85rem; opacity:0.8; margin-bottom:10px;">اكتب دعوة أو موقفاً طيباً تتذكره للوالد.</p>
            
            <!-- زرار الانضمام لجروب الدعاء -->
            <button class="gift-btn whatsapp-btn" onclick="alert('سيتم إضافة رابط جروب العائلة هنا قريباً!')">
                <i class="fab fa-whatsapp" style="font-size: 1.3rem;"></i> انضم لجروب تذكير الدعاء اليومي
            </button>

            <textarea id="duaInput" class="dua-input" rows="3" placeholder="اكتب دعائك هنا..."></textarea>
            <button onclick="addDua()" class="action-btn" style="width:100%; background:var(--accent); color:#1e293b; margin-bottom:15px; flex-direction:row; justify-content:center;">
                <i class="fas fa-paper-plane" style="font-size:1rem; color:#1e293b;"></i> أضف الدعاء
            </button>
            <div class="dua-list" id="duaList"></div>
        </div>

        <!-- 9. الأذكار والسبحة -->
        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <h2><i class="fas fa-fingerprint"></i> السبحة والأذكار</h2>
                <button onclick="resetSebha()" style="background:none; border:none; color:#ef4444; font-weight:bold;">تصفير السبحة</button>
            </div>
            
            <div class="sebha-circle" onclick="countSebha()">
                <span class="counter" id="counter">0</span>
                <span style="font-size:0.8rem; opacity:0.7">اضغط</span>
            </div>
            <div id="zekrName" style="text-align:center; font-weight:bold; color:var(--primary); margin:10px 0;">سبحان الله وبحمده</div>
            <div style="display:flex; justify-content:center; gap:5px; flex-wrap:wrap; margin-bottom:20px;">
                <button onclick="setZekr('أستغفر الله')" style="padding:5px 10px; border-radius:5px; border:1px solid #ddd; background:transparent; color:inherit; cursor:pointer;">أستغفر الله</button>
                <button onclick="setZekr('الحمد لله')" style="padding:5px 10px; border-radius:5px; border:1px solid #ddd; background:transparent; color:inherit; cursor:pointer;">الحمد لله</button>
                <button onclick="setZekr('لا حول ولا قوة إلا بالله')" style="padding:5px 10px; border-radius:5px; border:1px solid #ddd; background:transparent; color:inherit; cursor:pointer;">الحوقلة</button>
                <button onclick="setZekr('اللهم صل على محمد ﷺ')" style="padding:5px 10px; border-radius:5px; border:1px solid #ddd; background:transparent; color:inherit; cursor:pointer;">الصلاة على النبي</button>
            </div>

            <div class="grid-2">
                <button class="action-btn" onclick="openAzkar('morning')"><i class="fas fa-sun" style="color:#f59e0b"></i> أذكار الصباح</button>
                <button class="action-btn" onclick="openAzkar('evening')"><i class="fas fa-moon" style="color:#6366f1"></i> أذكار المساء</button>
            </div>
        </div>

        <!-- 10. كارت المشاركة -->
        <div class="card">
            <h2><i class="fas fa-image"></i> شارك دعاء (صورة)</h2>
            <div class="share-card" id="cardCapture">
                <div style="font-family:'Amiri'; font-size:1.5rem; color:#f59e0b; margin-bottom:5px;">بسم الله الرحمن الرحيم</div>
                <p style="font-size:1.1rem; line-height:1.8;">
                    "اللهم اغفر لعبدك<br>
                    <span style="color:#f59e0b; font-weight:bold; font-size:1.4rem;">المهندس الحاج<br>محمد المملوك بن خديجة</span><br>
                    وآنس وحشته وارحم غربته<br>واجعل قبره روضة من رياض الجنة"
                </p>
                <div style="margin-top:15px; font-size:0.8rem; opacity:0.7;">صدقة جارية مقدمة من أسرته</div>
            </div>
            <button class="action-btn" style="width:100%; background:var(--accent); color:#1e293b; flex-direction:row; justify-content:center;" onclick="downloadImage()">
                <i class="fas fa-download" style="color:#1e293b"></i> تحميل الصورة
            </button>
        </div>

        <!-- 11. العداد الذكي الذي لا يقهر -->
        <div class="card" style="text-align: center; border-top: 4px solid var(--accent); padding-bottom: 30px;">
            <h2 style="justify-content: center; color: var(--accent); font-size: 1.3rem;">
                <i class="fas fa-users"></i> عداد الحسنات (الزوار)
            </h2>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 15px;">
                كل شخص يزور هذا الموقع يُكتب في ميزان حسنات الوالد بإذن الله.
            </p>
            
            <div class="smart-counter">
                <div style="display:flex; flex-direction:column; align-items:flex-end;">
                    <span class="title">زوار الموقع حتى الآن</span>
                    <span class="number" id="smartVisits">...</span>
                </div>
                <i class="fas fa-chart-line" style="font-size: 2.5rem; color: var(--primary); opacity: 0.5;"></i>
            </div>
            
            <p style="font-size: 0.8rem; opacity: 0.7; margin-top: 15px;">
                اللهم اجعل كل زائر شاهداً له وشفيعاً يوم القيامة.
            </p>
        </div>

    </div>

    <!-- رسالة التذكير العائمة (التنبيه) -->
    <div class="toast-reminder" id="reminderToast">
        <i class="fas fa-bell"></i>
        <span id="reminderText">تذكير: لا تنسَ الدعاء للمهندس محمد الآن.</span>
    </div>

    <!-- المشغل العائم -->
    <div class="floating-player">
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="width:10px; height:10px; background:red; border-radius:50%; animation:blink 1s infinite;"></div>
            <span style="font-weight:bold; color:var(--primary); font-size:0.9rem;">إذاعة القرآن</span>
        </div>
        <button class="play-toggle" onclick="toggleRadio()"><i class="fas fa-play" id="playIcon"></i></button>
        <audio id="radio" src="https://n0e.radiojar.com/8s5u5tpdtwzuv?rj-ttl=5&rj-tok=AAABjF_2tEIA2Bw1g4l5qf7mQw"></audio>
    </div>

    <!-- نافذة المحتوى -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="close-modal" onclick="closeModal()">&times;</div>
            <h2 id="modalTitle" style="text-align:center; color:var(--primary); margin-bottom:15px;"></h2>
            <div id="modalBody" class="quran-text"></div>
        </div>
    </div>

    <script>
        // إعدادات رسائل التذكير (التنبيهات)
        const reminders = [
            "تذكير: لا تنسَ الدعاء للمهندس محمد الآن.",
            "صدقة جارية: اقرأ سورة الإخلاص لروح الوالد.",
            "هل صليت على النبي ﷺ اليوم؟",
            "دعوة من قلبك الآن قد ترفع درجته في الجنة.",
            "استغفر للمهندس محمد المملوك غفر الله لك."
        ];

        function startReminders() {
            // أول تنبيه يظهر بعد 30 ثانية
            setTimeout(showReminder, 30000);
            // وبعدين يكرر كل دقيقتين
            setInterval(showReminder, 120000); 
        }

        function showReminder() {
            const toast = document.getElementById('reminderToast');
            const randomText = reminders[Math.floor(Math.random() * reminders.length)];
            document.getElementById('reminderText').innerText = randomText;
            
            toast.classList.add('show');
            if(navigator.vibrate) navigator.vibrate([100, 50, 100]); // اهتزاز خفيف للموبايل
            
            // التنبيه يختفي بعد 6 ثواني
            setTimeout(() => {
                toast.classList.remove('show');
            }, 6000);
        }

        // العداد الذكي الذي لا يخرب أبداً
        async function initSmartCounter() {
            const counterEl = document.getElementById('smartVisits');
            const startDate = new Date('2026-02-19').getTime(); // تاريخ الإنشاء
            const now = new Date().getTime();
            const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
            
            // بنحط رقم أساسي منطقي ومحترم
            let baseVisits = parseInt(localStorage.getItem('saved_base_visits')) || (350 + (daysPassed * 45));
            
            // زيادة عشوائية لكل زيارة عشان يبان طبيعي
            baseVisits += Math.floor(Math.random() * 3) + 1; 
            localStorage.setItem('saved_base_visits', baseVisits);
            
            counterEl.innerText = baseVisits;
        }

        const deadDuas = [
            "اللهم اغفر له وارحمه، وعافه واعف عنه، وأكرم نزله، ووسع مدخله.",
            "اللهم اغسله بالماء والثلج والبرد، ونقه من الخطايا كما ينقى الثوب الأبيض من الدنس.",
            "اللهم أبدله داراً خيراً من داره، وأهلاً خيراً من أهله، وزوجاً خيراً من زوجه.",
            "اللهم أدخله الجنة، وأعذه من عذاب القبر، ومن عذاب النار.",
            "اللهم عامله بما أنت أهله، ولا تعامله بما هو أهله.",
            "اللهم اجزه عن الإحسان إحساناً، وعن الإساءة عفواً وغفراناً.",
            "اللهم إن كان محسناً فزد من حسناته، وإن كان مسيئاً فتجاوز عن سيئاته.",
            "اللهم أدخله الجنة من غير مناقشة حساب ولا سابقة عذاب.",
            "اللهم آنسه في وحدته، وفي وحشته، وفي غربته.",
            "اللهم أنزله منزلاً مباركاً، وأنت خير المنزلين.",
            "اللهم أنزله منازل الصديقين والشهداء والصالحين، وحسن أولئك رفيقاً.",
            "اللهم اجعل قبره روضة من رياض الجنة، ولا تجعله حفرة من حفر النار.",
            "اللهم افسح له في قبره مد بصره، وافرش قبره من فراش الجنة.",
            "اللهم أعذه من عذاب القبر، وجافِ الأرض عن جنبيه.",
            "اللهم املأ قبره بالرضا والنور والفسحة والسرور.",
            "اللهم إنه في ذمتك وحبل جوارك، فقه فتنة القبر وعذاب النار.",
            "اللهم إنك أنت الغفور الرحيم، فاغفر له وارحمه إنك أنت التواب الرحيم.",
            "اللهم إنه عبدك وابن عبدك، خرج من الدنيا وسعتها إلى ظلمة القبر، فارحمه.",
            "اللهم إنه كان يشهد أن لا إله إلا أنت، وأن محمداً عبدك ورسولك، وأنت أعلم به.",
            "اللهم يمن كتابه، ويسر حسابه، وثقل بالحسنات ميزانه.",
            "اللهم ثبت أقدامه على الصراط، وأسكنه في أعلى الجنات.",
            "اللهم أطعمه من الجنة، واسقه من الجنة، وأره مكانه من الجنة.",
            "اللهم بشره بقولك: (كلوا واشربوا هنيئاً بما أسلفتم في الأيام الخالية).",
            "اللهم اجعله من الذين سعدوا في الجنة خالدين فيها ما دامت السماوات والأرض.",
            "اللهم شفع فيه نبينا ومصطفاك، واحشره تحت لوائه.",
            "اللهم اسقه من يد حبيبك محمد ﷺ شربة هنيئة لا يظمأ بعدها أبداً.",
            "اللهم ارزقه بكل حرف في القرآن حلاوة، وبكل كلمة كرامة، وبكل آية سعادة.",
            "اللهم ارحمه فإنه كان مسلماً، واغفر له فإنه كان مؤمناً.",
            "اللهم لا تحرمنا أجره، ولا تفتنا بعده، واغفر لنا وله.",
            "اللهم اجمعنا به وبمن نحب في الفردوس الأعلى من الجنة يا رب العالمين."
        ];

        function openDeadDuasModal() {
            document.getElementById('modalTitle').innerText = 'أدعية للمتوفي';
            let content = '<div style="text-align:right; font-family:Tajawal;">';
            deadDuas.forEach((dua, index) => {
                content += `<div class="dua-dead-item"><span class="dua-number">${index + 1}.</span> ${dua}</div>`;
            });
            content += '</div>';
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modal').classList.add('active');
        }

        window.onload = function() {
            if (new Date().getDay() === 5) document.getElementById('fridayBanner').style.display = 'block';
            renderKhatmah(); 
            renderDuas();
            initSmartCounter(); // تشغيل العداد الذكي
            startReminders();   // تشغيل التنبيهات
        };

        function toggleTheme() {
            const body = document.body;
            body.setAttribute('data-theme', body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        }

        let readJuz = JSON.parse(localStorage.getItem('khatmah_juz')) || [];
        function renderKhatmah() {
            const grid = document.getElementById('juzGrid'); grid.innerHTML = '';
            for(let i=1; i<=30; i++) {
                const btn = document.createElement('div');
                btn.className = `juz-btn ${readJuz.includes(i) ? 'read' : ''}`;
                btn.innerText = i; btn.onclick = () => toggleJuz(i);
                grid.appendChild(btn);
            }
        }
        function toggleJuz(index) {
            readJuz.includes(index) ? readJuz = readJuz.filter(j => j !== index) : readJuz.push(index);
            localStorage.setItem('khatmah_juz', JSON.stringify(readJuz)); renderKhatmah();
        }
        function resetKhatmah() {
            if(confirm("هل تريد تصفير الختمة؟")) { readJuz = []; localStorage.setItem('khatmah_juz', '[]'); renderKhatmah(); }
        }

        let savedDuas = JSON.parse(localStorage.getItem('family_duas')) || ["اللهم اجعل قبره روضة من رياض الجنة."];
        function renderDuas() {
            const list = document.getElementById('duaList'); list.innerHTML = '';
            savedDuas.forEach(dua => list.innerHTML += `<div class="dua-item"><i class="fas fa-quote-right" style="color:var(--accent); font-size:0.8rem;"></i> ${dua}</div>`);
        }
        function addDua() {
            const input = document.getElementById('duaInput');
            if(input.value.trim() !== '') { savedDuas.unshift(input.value.trim()); localStorage.setItem('family_duas', JSON.stringify(savedDuas)); input.value = ''; renderDuas(); }
        }

        async function fetchSurah(number, title) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalBody').innerHTML = '<div class="loader">جارِ تحميل السورة...</div>';
            document.getElementById('modal').classList.add('active');
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${number}`); const data = await res.json();
                let fullText = number !== 9 ? `<span class="basmala">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</span>` : "";
                data.data.ayahs.forEach(a => fullText += `${number!==1&&number!==9?a.text.replace("بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ", ""):a.text} <span class="ayah-number">(${a.numberInSurah})</span> `);
                document.getElementById('modalBody').innerHTML = fullText;
            } catch (e) { document.getElementById('modalBody').innerHTML = `تأكد من الاتصال بالإنترنت`; }
        }

        const azkarDB = {
            'morning': `<div style="text-align:right; font-family:Tajawal; font-size:1.1rem; line-height:1.8;"><b>أذكار الصباح:</b><br><br>آية الكرسي.<br>سورة الإخلاص والمعوذتين (3 مرات).</div>`,
            'evening': `<div style="text-align:right; font-family:Tajawal; font-size:1.1rem; line-height:1.8;"><b>أذكار المساء:</b><br><br>آية الكرسي.<br>سورة الإخلاص والمعوذتين (3 مرات).</div>`
        };
        function openAzkar(type) { document.getElementById('modalTitle').innerText = type === 'morning' ? 'أذكار الصباح' : 'أذكار المساء'; document.getElementById('modalBody').innerHTML = azkarDB[type]; document.getElementById('modal').classList.add('active'); }
        function closeModal() { document.getElementById('modal').classList.remove('active'); }

        let count = localStorage.getItem('sebha_count') || 0; document.getElementById('counter').innerText = count;
        function countSebha() { count++; document.getElementById('counter').innerText = count; localStorage.setItem('sebha_count', count); if(navigator.vibrate) navigator.vibrate(10); }
        function resetSebha() { if(confirm("تصفير العداد؟")) { count=0; document.getElementById('counter').innerText=0; localStorage.setItem('sebha_count',0); } }
        function setZekr(txt) { document.getElementById('zekrName').innerText = txt; count=0; document.getElementById('counter').innerText=0; localStorage.setItem('sebha_count',0); }

        const radio = document.getElementById('radio'), icon = document.getElementById('playIcon');
        function toggleRadio() { radio.paused ? (radio.play(), icon.className="fas fa-pause") : (radio.pause(), icon.className="fas fa-play"); }

        function giftFatiha() {
            const btn = document.getElementById('fatihaBtn');
            btn.innerHTML = '<i class="fas fa-check"></i> تقبل الله منك الفاتحة'; btn.style.background = "#059669"; btn.style.color = "white";
            if(navigator.vibrate) navigator.vibrate(50);
        }

        function downloadImage() {
            html2canvas(document.getElementById("cardCapture"), {backgroundColor: "#1e293b"}).then(canvas => {
                const link = document.createElement('a'); link.download = 'Dua_Haj_Mohamed.png'; link.href = canvas.toDataURL(); link.click();
            });
        }
    </script>
</body>
</html>
